#!/usr/bin/env sh

echo ""
echo "๐ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "   PRE-COMMIT VALIDATIONS - TestForge"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ ๐"
echo ""

# 1. Type checking (TypeScript)
echo "๐ [1/3] Verificando tipos TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo ""
  echo "โ Error: Type-check fallรณ. Corrige los errores de TypeScript antes de hacer commit."
  echo ""
  exit 1
fi
echo "โ Type-check pasรณ correctamente"
echo ""

# 2. Lint-staged (ESLint + Prettier en archivos staged)
echo "๐งน [2/3] Ejecutando ESLint y Prettier en archivos staged..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo ""
  echo "โ Error: Lint-staged fallรณ. Revisa los errores de linting/formato."
  echo ""
  exit 1
fi
echo "โ Lint y formato completados"
echo ""

# 3. Build check (opcional pero recomendado)
echo "๐๏ธ  [3/3] Verificando que el proyecto compila..."
npm run build
if [ $? -ne 0 ]; then
  echo ""
  echo "โ Error: Build fallรณ. El proyecto debe compilar antes de hacer commit."
  echo ""
  exit 1
fi
echo "โ Build exitoso"
echo ""

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ Todas las validaciones pasaron. Procediendo con el commit..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
